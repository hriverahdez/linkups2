angular.module("linkups2").controller("addInstCtrl",["$scope","$state","instData","notificationService","$rootScope","ModalService","utilityService",function(a,b,c,d,e,f,g){a.isLoading=!1,a.isEdit=!1,a.institution={state:"Activo",final_destination:"VPN Provincial",type:"NODO"},a.selectionOpts=[{state:"Activo",destination:"VPN Provincial"},{state:"Inactivo",destination:"Infomed"}],a.instTypes={},angular.copy(g.getInstitutionTypes(),a.instTypes),a.save=function(f){g.showLoader(),c.saveInst(a.institution,function(){g.hideLoader(),d.notifySave(a.institution.name),d.getAmountOfUnreadNotifications().then(function(a){e.$broadcast("notificationCountUp",{unreadNotifications:a})}),b.go("home")},function(a){console.log(a.message)})},a.cancel=function(){b.go("home")}}]),angular.module("linkups2").controller("deleteInstCtrl",["$scope","$state","auth","$element","close","inst_id","instData","utilityService","notificationService","$rootScope","view",function(a,b,c,d,e,f,g,h,i,j,k){a.isView=k,a.hasLan=!0,g.getById({id:f},function(b){a.info=b,a.hasLan=null!=a.info.lan}),a.typeIconClasses=h.getInstTypeIcons("fa-5x"),a.internetStatusIcons=h.getHasInternetIcons("fa-1x"),a.close=function(){g.deleteInst({id:f},function(){i.notifyDelete(a.info.name),i.getAmountOfUnreadNotifications().then(function(a){j.$broadcast("notificationCountUp",{unreadNotifications:a})})}),b.transitionTo("home",{},{reload:!0}),e({},500)},a.cancel=function(){d.modal("hide"),e({},500)}}]),angular.module("linkups2").controller("homeCtrl",["$scope","instData","ModalService","utilityService","$filter","DTOptionsBuilder",function(a,b,c,d,e,f){a.typeIconClasses=d.getInstTypeIcons("fa-2x fa-fw"),a.legendIconClasses=d.getInstTypeIcons("fa-1x"),a.selectedPage=1,a.pageSize=2,a.selectPage=function(b){a.selectedPage=b},a.dtOptions=f.newOptions().withOption("hasBootstrap",!0),b.getAllInstitutions(function(b){a.institutions=b}),a.viewInst=function(a){c.showModal({templateUrl:"/templates/modal.html",controller:"deleteInstCtrl",inputs:{inst_id:a,view:!0}}).then(function(a){a.element.modal()})},a.deleteInst=function(a){c.showModal({templateUrl:"/templates/modal.html",controller:"deleteInstCtrl",inputs:{inst_id:a,view:!1}}).then(function(a){a.element.modal()})}}]),angular.module("linkups2").controller("loginCtrl",["$scope","$state","auth","$rootScope","settingsService",function(a,b,c,d,e){a.user={},a.error,a.userIsAvailable=!1,a.userIsNotAvailable=!0,a.canCheck=!1,a.passwordsDontMatch=!0,a.create=!1,e.getSettings().then(function(b){a.canRegister=b.data[0].canRegister},function(a){}),"createUser"==b.$current.name&&(a.create=!0),a.canCheckAvailability=function(){void 0!=a.user.username&&""!=a.user.username?a.canCheck=!0:a.canCheck=!1},a.checkPasswordsMatch=function(){a.user.password!=a.user.passconfirm?(a.error={message:"Las contraseñas no coinciden"},a.passwordsDontMatch=!0):(a.error=null,a.passwordsDontMatch=!1)},a.isLogged=c.isLoggedIn(),a.checkUserAvailability=function(){c.checkUserAvailability(a.user).then(function(b){a.userIsAvailable=b.data.available,a.userIsNotAvailable=b.data.available})},a.register=function(){c.register(a.user).error(function(b){a.error=b}).then(function(){b.go("home",{},{reload:!0})})},a.createUser=function(){c.createUser(a.user).error(function(b){a.error=b}).then(function(){b.go("home",{},{reload:!0})})},a.logIn=function(){c.logIn(a.user).error(function(b){a.error=b}).then(function(){b.go("home",{},{reload:!0})})},a.logOut=function(){c.logOut()}}]),angular.module("linkups2").controller("notificationCtrl",["$scope","auth","notificationService","$timeout","utilityService","DTOptionsBuilder",function(a,b,c,d,e,f){a.sortOrder="-time",a.notificationIcons=e.getNotificationIcons("fa-1x"),a.updateNotificationList=function(){c.getAllNotifications().then(function(b){a.notifications=b})},a.updateNotificationList(),a.dtOptions=f.newOptions().withOption("hasBootstrap",!0),c.getAmountOfUnreadNotifications().then(function(b){a.unreadNotifications=b}),a.$on("notificationCountUp",function(b,c){a.unreadNotifications=c.unreadNotifications,a.updateNotificationList()}),a.readAll=function(){d(function(){c.readAllNotifications().then(function(){a.updateNotificationList(),a.unreadNotifications=0})},2e3)}}]),angular.module("linkups2").controller("profileCtrl",["$scope","auth","$state",function(a,b,c){a.passwordChange=!1,a.passwordsDontMatch=!1,a.somethingChanged=!1,a.hasUpdated=function(){a.somethingChanged=!0},a.user={username:b.currentUser(),fullname:b.currentUserFullName()},a.checkPasswordsMatch=function(){a.somethingChanged=!0,a.user.password!=a.user.passconfirm?(a.error={message:"Las contraseñas no coinciden"},a.passwordsDontMatch=!0):(a.error=null,a.passwordsDontMatch=!1)},a.passCheckChange=function(){a.passwordChange||(a.user.password=null,a.user.passconfirm=null)},a.updateProfile=function(){null!=a.user.password&&""!=a.user.password||!a.passwordChange?(a.passwordChange||(a.user.password="not"),b.updateProfile(a.user),c.go("home",{},{reload:!0})):a.error={message:"El campo de contraseña no puede estar vacío"}}}]),angular.module("linkups2").controller("settingsCtrl",["$scope","settingsService","$state","$rootScope",function(a,b,c,d){b.getSettings().then(function(b){a.setting=b.data[0]}),a.saveSettings=function(){b.saveSettings(a.setting),d.$broadcast("settingsSaved",{newProvinceName:a.setting.provinceName}),c.go("home")}}]),angular.module("linkups2").controller("statsCtrl",["$scope","instData","$filter","settingsService","utilityService",function(a,b,c,d,e){a.bandwidthGroups=[],a.internetGroups=[],a.institutionTypeGroups=[],b.getAllInstitutions(function(b){a.institutions=b,a.groupBy(a.institutions,a.bandwidthGroups,"bandwidth","Kbps");var c={first:{type:"true",name:"SI"},second:{type:"false",name:"NO"}};a.groupBy(a.institutions,a.internetGroups,"has_internet","",c);var d=e.getInstitutionTypes();a.groupBy(a.institutions,a.institutionTypeGroups,"type","",d)}),a.groupBy=function(a,b,c,d,e){if(angular.forEach(a,function(a){for(var e=-1,f=0;f<b.length;f++)if(b[f]&&b[f].label==a[c]+d){e=f;break}e==-1?b[b.length]={label:a[c]+d,value:1}:b[e].value++}),e)for(var f=0;f<b.length;f++)angular.forEach(e,function(a){b[f].label==a.type&&(b[f].label=a.name)})},a.test=[[{label:"Paper Cost",value:"25"},{label:"Binding",value:"20"},{label:"Printing Cost",value:"20"},{label:"Royality",value:"15"},{label:"Transportation Cost",value:"10"},{label:"Promotion Cost",value:"10"}],[{label:"Paper Cost",value:"25"},{label:"Binding",value:"20"},{label:"Printing Cost",value:"20"},{label:"Royality",value:"15"},{label:"Transportation Cost",value:"10"},{label:"Promotion Cost",value:"10"}],[{label:"Paper Cost",value:"25"},{label:"Binding",value:"20"},{label:"Printing Cost",value:"20"},{label:"Royality",value:"15"},{label:"Transportation Cost",value:"10"},{label:"Promotion Cost",value:"10"}]],a.getChartCommonOpts=function(){var a={},b={bgcolor:"FFFFFF",showvalues:"1",showpercentvalues:"0",showborder:"0",showplotborder:"0",showlegend:"1",legendborder:"0",legendposition:"bottom",enablesmartlabels:"1",use3dlighting:"0",showshadow:"0",legendbgcolor:"#CCCCCC",legendbgalpha:"20",legendborderalpha:"0",legendshadow:"0",legendnumcolumns:"3",palettecolors:"#f8bd19,#e44a00,#008ee4,#33bdda,#6baa01,#583e78,#00CC66,#36BAE2",enableRotation:"0",enableMultiSlicing:"0"};return angular.copy(b,a),a};var f="Ancho de banda de los Enlaces";a.bandwidthData={chart:a.getChartCommonOpts(),data:a.bandwidthGroups};var g="Cantidad de instituciones por tipo";a.institutionTypeData={chart:a.getChartCommonOpts(),data:a.institutionTypeGroups};var h="Cantidad de instituciones con acceso a Internet";a.internetData={chart:a.getChartCommonOpts(),data:a.internetGroups},d.getSettings().then(function(b){a.bandwidthData.chart.caption=f,a.bandwidthData.chart.subcaption=b.data[0].provinceName,a.internetData.chart.caption=h,a.internetData.chart.subcaption=b.data[0].provinceName,a.institutionTypeData.chart.caption=g,a.institutionTypeData.chart.subcaption=b.data[0].provinceName})}]),angular.module("linkups2").controller("updateInstCtrl",["$scope","$state","$stateParams","auth","instData","notificationService","$rootScope","utilityService",function(a,b,c,d,e,f,g,h){a.isEdit=!0,a.institution={state:"Activo",final_destination:"VPN Provincial"},a.selectionOpts=[{state:"Activo",destination:"VPN Provincial"},{state:"Inactivo",destination:"Infomed"}],a.instTypes={},angular.copy(h.getInstitutionTypes(),a.instTypes),e.getById({id:c.id},function(b){a.institution=b}),a.save=function(c){if(c.$valid){var i=new Date;a.institution.last_modification_by=d.currentUser(),a.institution.last_modification_time=i.getTime(),h.showLoader(),e.updateInst(a.institution,function(){f.notifyUpdate(a.institution.name),h.hideLoader(),f.getAmountOfUnreadNotifications().then(function(a){g.$broadcast("notificationCountUp",{unreadNotifications:a})}),b.go("home")})}},a.cancel=function(){b.go("home")}}]),angular.module("linkups2").controller("viewUsersCtrl",["$scope","auth","ModalService","$element","$rootScope","$state",function(a,b,c,d,e,f){b.retrieveUserList().then(function(b){a.users=b.data,angular.forEach(a.users,function(b){"admin"==b.username&&(a.admin=b)})}),a.deleteUser=function(a){c.showModal({templateUrl:"/templates/confirmDeleteModal.html",controller:"confirmModalCtrl",inputs:{deleteUserId:a}}).then(function(a){a.element.modal()})}}]).controller("confirmModalCtrl",["$scope","deleteUserId","auth","$state",function(a,b,c,d){a.confirm=function(){console.log(b),c.deleteUser(b),d.transitionTo("viewUsers",{},{reload:!0}),close({},500)},a.cancel=function(){$element.modal("hide"),close({},500)}}]),angular.module("linkups2").factory("auth",["$http","$window","$resource","$q",function(a,b,c,d){var e={},f={"Content-Type":"application/x-www-form-urlencoded"},g=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};return e.saveToken=function(a){b.localStorage["linkups2-token"]=a},e.getToken=function(){return b.localStorage["linkups2-token"]},e.logOut=function(){b.localStorage.removeItem("linkups2-token")},e.isLoggedIn=function(){var a=e.getToken();if(a){var c=JSON.parse(b.atob(a.split(".")[1]));return c.exp>Date.now()/1e3}return!1},e.isLoggedIn()&&(f.Authorization="Bearer "+e.getToken()),e.currentUser=function(){if(e.isLoggedIn()){var a=e.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.username}},e.currentUserFullName=function(){if(e.isLoggedIn()){var a=e.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.fullname}},e.register=function(b){return a({method:"POST",url:"/api/users/register",headers:f,transformRequest:g,data:{username:b.username,fullname:b.fullname,password:b.password}}).success(function(a){e.saveToken(a.token)})},e.createUser=function(b){return a({method:"POST",url:"/api/users/register",headers:f,transformRequest:g,data:{username:b.username,fullname:b.fullname,password:b.password}}).success(function(a){})},e.logIn=function(b){return a({method:"POST",url:"/api/users/login",headers:f,transformRequest:g,data:{username:b.username,password:b.password}}).success(function(a){e.saveToken(a.token),f.Authorization="Bearer "+e.getToken()})},e.checkUserAvailability=function(b){return a({method:"POST",url:"/api/users/check",headers:f,transformRequest:g,data:{username:b.username,password:b.password}}).success(function(a){}).error(function(a){console.log("error")})},e.updateProfile=function(b){return a({method:"PUT",url:"/api/users/updateProfile",headers:f,transformRequest:g,data:{username:b.username,fullname:b.fullname,password:b.password}}).success(function(a){e.saveToken(a.token)})},e.retrieveUserList=function(){return a({method:"GET",url:"/api/users",headers:f,transformRequest:g,isArray:!0}).success(function(a){}).error(function(a){console.log("error")})},e.deleteUser=function(b){return a({method:"DELETE",url:"/api/users/"+b,headers:f,transformRequest:g}).success(function(a){}).error(function(a){console.log("error")})},e}]),angular.module("linkups2").factory("instData",["$resource","auth",function(a,b){var c="/api/institutions/:id",d={"Content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+b.getToken()},e=function(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")},f={getAllInstitutions:{method:"GET",isArray:!0,headers:d},getById:{method:"GET",headers:d},saveInst:{method:"POST",headers:d,transformRequest:e},updateInst:{method:"PUT",isArray:!1,headers:d,transformRequest:e},deleteInst:{method:"DELETE",headers:d}},g=a(c,{id:"@_id"},f);return g}]),angular.module("linkups2").factory("notificationService",["$resource","auth","$q",function(a,b,c){var d="/api/notifications/:id",e={"Content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+b.getToken()},f=function(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")},g={getAllNotifications:{method:"GET",isArray:!0,headers:e},getById:{method:"GET",headers:e},saveNotification:{method:"POST",headers:e,transformRequest:f},updateNotification:{method:"PUT",isArray:!1,headers:e,transformRequest:f},deleteNotification:{method:"DELETE",headers:e}},h=a(d,{id:"@_id"},g),i={};return i.notifySave=function(a){var c=new Date,d={type:"SAVE",message:"Creado: "+a,user:b.currentUser(),time:c.getTime()};h.saveNotification(d)},i.notifyUpdate=function(a){var c=new Date,d={type:"UPDATE",message:"Actualizado: "+a,user:b.currentUser(),time:c.getTime()};h.saveNotification(d)},i.notifyDelete=function(a){var c=new Date,d={type:"DELETE",message:"Eliminado: "+a,user:b.currentUser(),time:c.getTime()};h.saveNotification(d)},i.read=function(a){h.updateNotification(a)},i.getAllNotifications=function(){var a=c.defer();return h.getAllNotifications(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},i.getAmountOfUnreadNotifications=function(){var a=c.defer();return i.getAllNotifications().then(function(b){var c=0;angular.forEach(b,function(a){a.read||c++}),a.resolve(c)}),a.promise},i.readAllNotifications=function(){return i.getAllNotifications().then(function(a){angular.forEach(a,function(a){a.read||i.read(a)})})},i}]),angular.module("linkups2").factory("settingsService",["$resource","auth","$q","$http",function(a,b,c,d){var e="/api/settings",f={"Content-type":"application/x-www-form-urlencoded"},g=function(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")},h={};return h.getSettings=function(){return d({method:"GET",url:e,headers:f,transformRequest:g,isArray:!0}).success(function(a){}).error(function(a){console.log(a)})},h.saveSettings=function(a){return d({method:"POST",url:e,headers:f,transformRequest:g,data:{canRegister:a.canRegister,provinceName:a.provinceName}}).success(function(a){})},h.initialSettings=function(){return d({method:"POST",url:e+"/initialize",headers:f,transformRequest:g}).success(function(a){})},h}]),angular.module("linkups2").factory("utilityService",["$rootScope",function(a){var b={},c={NODO:{type:"NODO",name:"NODO",iconClass:"fa fa-sitemap "},policlinico:{type:"policlinico",name:"Policlinico",iconClass:"fa fa-stethoscope "},hospital:{type:"hospital",name:"Hospital",iconClass:"fa fa-heartbeat "},dir_salud:{type:"dir_salud",name:"Dirección de Salud",iconClass:"fa fa-building "},c_genetica:{type:"c_genetica",name:"Centro de Genética",iconClass:"fa fa-venus-mars "},b_sangre:{type:"b_sangre",name:"Banco de Sangre",iconClass:"fa fa-tint "},c_higiene:{type:"c_higiene",name:"Centro de Higiene y Epidemiología",iconClass:"fa fa-h-square "},filial:{type:"filial",name:"Filial Estudiantil",iconClass:"fa fa-university "},other:{type:"other",name:"Otros",iconClass:"fa fa-ellipsis-h "}};return b={institutionTypes:c},b.getInstitutionTypes=function(){return b.institutionTypes},b.getInstTypeIcons=function(a){var c={};return angular.copy(b.institutionTypes,c),angular.forEach(c,function(b){b.iconClass=b.iconClass+a}),c},b.getHasInternetIcons=function(a){var b={true:"fa fa-thumbs-up "+a,false:"fa fa-thumbs-down "+a};return b},b.getNotificationIcons=function(a){var b={SAVE:"fa fa-plus "+a,UPDATE:"fa fa-pencil "+a,DELETE:"fa fa-trash "+a,LOGIN:"fa fa-sign-in "+a,true:"fa fa-check-circle "+a,false:"fa fa-circle-thin "+a};return b},b.showLoader=function(){a.loadingOperation=!0},b.hideLoader=function(){a.loadingOperation=!1},b}]),function(){angular.module("linkups2",["ui.router","ngResource","angularModalService","datatables","datatables.bootstrap","ng-fusioncharts"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){a.state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"loginCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()&&a.go("home")}]}).state("register",{url:"/register",templateUrl:"/templates/register.html",controller:"loginCtrl",onEnter:["$state","auth","settingsService",function(a,b,c){b.isLoggedIn()&&a.go("home"),c.getSettings().then(function(b){var c=b.data[0].canRegister;c||a.go("login")})}]}).state("home",{url:"/home",templateUrl:"/templates/home.html",controller:"homeCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("addInst",{url:"/addInst",templateUrl:"/templates/addInst.html",controller:"addInstCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("updateInst",{url:"/updateInst/:id",templateUrl:"/templates/addInst.html",controller:"updateInstCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("showAllNotifications",{url:"/showAllNotifications",templateUrl:"/templates/notifications.html",controller:"notificationCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("viewUsers",{url:"/viewUsers",templateUrl:"/templates/viewUsers.html",controller:"viewUsersCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("viewProfile",{url:"/viewProfile",templateUrl:"/templates/profile.html",controller:"profileCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("createUser",{url:"/createUser",templateUrl:"/templates/register.html",controller:"loginCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("stats",{url:"/stats",templateUrl:"/templates/stats.html",controller:"statsCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}).state("settings",{url:"/settings",templateUrl:"/templates/settings.html",controller:"settingsCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()||a.go("login")}]}),b.otherwise("login")}]).run(function(a,b,c,d){a.initialConfig=function(){var b={username:"admin",fullname:"DEFAULT USER",password:"admin"};c.checkUserAvailability(b).then(function(a){a.data.available&&c.createUser(b)}),d.initialSettings(),d.getSettings().then(function(b){a.provinceName=b.data[0].provinceName})},a.initialConfig(),a.$on("settingsSaved",function(b,c){a.provinceName=c.newProvinceName}),a.loadingOperation=!1,a.showNavbar=!1,a.getCurrentUser=function(){a.currentUser=c.currentUser()},a.checkIfUserLoggedIn=function(){return c.isLoggedIn()},a.logOut=function(){c.logOut()},a.$on("$stateChangeStart",function(b,c,d,e,f){"login"===c.name||"register"===c.name?a.showNavbar=!1:a.checkIfUserLoggedIn()&&(a.getCurrentUser(),a.showNavbar=!0)})})}();